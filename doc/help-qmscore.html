<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN">
<html>
<head>
<title>MOEDivcon QMScore Help</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<meta http-equiv="content-style-type" content="text/css" />
<style>
h1 {font: bold 2.0em Helvetica, sans-serif; color: #0099DD;
    text-align: center;}
h2 {font: bold 1.5em Helvetica, sans-serif; color: #44AAEE;
    background-color: #FFFFFF; counter-increment:h2n;counter-reset:h3n}
h2:before {content: counter(h2n, upper-roman) ".  "}
h3 {font: bold 1.25em Helvetica, sans-serif; color: #44AAEE;
    background-color: #FFFFFF;counter-increment:h3n;counter-reset:h4n}
h3:before {content: counter(h3n, upper-latin) ".  "}
h4 {font: bold 1.00em Helvetica, sans-serif; color: #0099DD;
    background-color: #FFFFFF;counter-increment:h4n;}
h4:before {content: counter(h4n, decimal) ".  "}
body {font: 12pt "Times New Roman", serif; margin: 3em;
    background-color: #F0F7FF;}
ol#tocl {list-style-type: upper-roman;}
ol ol {list-style-type: upper-latin;}
w {text-decoration: underline;}
x {font-weight: bold;}
todo {font: bold 11pt "Helvetica", sans-serif; padding: 1px 2px; margin: 2px;
      border: thin solid red;}
todo:before {content: "TODO: "; color: red;}
pre {margin-left: 4em; font: bold 11pt "Courier", serif;}
inlinecode {font: bold 11pt "Arial", serif;}
prob {font: italic 11pt "Helvetica", sans-serif;}
sol {font: 11pt "Times New Roman", serif;}
sol:before {content: "Possible solution:  "; color:  #0099DD; }
</style>
</head>

<body>
<hr>
<p>
<a href="http://www.quantumbioinc.com" target="QBHomePage"> <object height=51 align=left
  data="images/qb_logo.png" type=image/png>
QuantumBio
</object> </a>
<a href="http://www.quantumbioinc.com"target="QBHomePage"> <object id=ri height=51 align=right
  data="images/qb_logo.png" type=image/png>
QuantumBio
</object> </a>
<h1>MOEDivcon QMScore</h1>
</p>
<hr>

<h2><a name="ToC"></a>Table of Contents</h2>
<ol id=tocl>
  <li><a href="ToC">Table of Contents</a></li>
  <li><a href="#intro">QMScore Introduction</a></li>
  <li><a href="#install">Installation</a></li>
  <li><a href="#start">Getting Started</a></li>
  <li><a href="#options">Options</a></li>
  <ol>
    <li><a href="#options-outdb">Output MOE Database</a></li>
    <li><a href="#options-workdir">Working Directory</a></li>
    <li><a href="#options-ham">Hamiltonian</a></li>
    <li><a href="#options-opt">Ligand Optimization</a></li>
    <li><a href="#options-freq">Frequency</a></li>
  </ol>
  <li><a href="#parallel">Batch and Parallel Execution</a></li>
  <ol>
    <li><a href="#parallel-moebatch">Moebatch</a></li>
    <li><a href="#parallel-mode">Parallel Mapping Mode</a></li>
  </ol>
  <li><a href="#trouble">Troubleshooting</a></li>
</ol>

<h2><a name="intro"></a>QMScore Introduction</h2>

<p>
Analogous to conventional scoring functions from other vendors, QuantumBio
provides a scoring function based upon linear-scaling, semi-empirical, quantum
mechanics. This patent pending algorithm characterizes the entire target/ligand
complex quantum mechanically, and determines the energy of binding.
</p>
<p>
The QMScore algorithm has been validated against several key structural motifs,
and the results of these validations have been detailed in several 
key peer-reviewed 
<a href="http://www.quantumbioinc.com/Support/Publications/index_files/category-qmscore.html" target="QBHomePage">publications</a>.
</p>

<h2><a name="install"></a>Installation</h2>

<p>
The Binary Distribution requires some knowledge of the Linux/Unix
environment. The following set of steps will show you the types of
commands you will need to execute in order to properly install DivCon.
</p>
<p>


The distribution is found within a tar.gz file. This file must be
uncompressed in order to install the application. To begin, put the
tar.gz file in a place where you like it. Anywhere will do, but a
good place for it may be /usr/local. Once you put the file in /usr/local
you will need to type the following:
<p>
<pre>
> tar -zxvf divcon-&lt;platform&gt;-&lt;version&gt;.tar.gz
</pre>
</p>

<p>
Once the file has decompressed, it is ready to become part of your
environment. This will require the addition of the $QBHOME environment
variable along with the sourcing of an environment file (qbenv.sh
or qbenv.csh). By adding two lines to your .bashrc file (for the
bash shell) or .cshrc file (for the csh or the tcsh shells), you will
be able to access DivCon features. You should execute the following
in order to (a) find the correct installation directory and switch
to the bash shell, (b) set that installation path in both .bashrc
and .cshrc, and (c) source the correct QuantumBio supplied environment
file. The install.sh file within the DivCon root directory is provided
for this purpose. It will set the <inlinecode>$QBHOME </inlinecode> variable
and allow the correct files to be sourced upon login. Note: this install.sh
script will need to be executed for each user.
</p>

<p>
<pre>
> cd divcon-&lt;platform&gt;-&lt;version&gt; ; <A NAME="119"></A>./install.sh
</pre>
</p>

<p>
Now simply re-login to make sure that environment features have taken.
Once you re-login, you should be able to run the following test. This
test will simply check the environment, and run the prep characteristics
of the simulation without actually performing any of the quantum mechanics
calculation.
</p>

<p>
<pre>
> cd   $QBHOME/Examples/1PEF
</pre>
</p>
<p>
<pre>
> divcon   -i   1PEF.mol2   -test
</pre>
</p>
<p>
If you have not installed a license file, the above test will fail
with a statement that an license file must be obtained. Contact sales@quantumbioinc.com
to purchase a license file. Once you have received a license file
from QuantumBio, you may install the file with a simple move statement.
</p>

<p>
<pre>
> mv   license-file   $QBHOME/etc/license
</pre>
</p>


<p>
Before you can run QMScore using MOE or moebatch, you need to make sure that
the MOEDivcon executables are in your path.  For example, you should add to
your .bashrc file:
</p>
<p>
<pre>
> export  PATH=${QBHOME}/bin:${PATH}
</pre>
</p>
<p>
or add to your .cshrc file:
</p>
<p>
<pre>
> setenv   PATH   ${QBHOME}/bin:${PATH}
</pre>
</p>

<p>
The last two steps of the installation are very important.  First,
you need to copy the MOEDivcon menu file to your home directory.
For example:
<p>
<pre>
> cat   ${QBHOME}/moe_menus  >> ${HOME}/moe_menus
</pre>
</p>
</p>
<p>
Second, in order for
MOE to locate the MOEDivcon SVL library, you must create a link to the
library in a place where MOE can find it.  If you already have a directory
of SVL scripts, link the MOEDivcon SVL libarary as a subdirectory.
For example:
<p>
<pre>
> ln -s   ${QBHOME}/svl   ${MOE_SVL_PATH}/qb_lib.svl
</pre>
</p>
Otherwise, create an SVL directory in your home directory and link the
MOEDivcon SVL library under it.  For example:
<p>
<pre>
> mkdir  ${HOME}/svl
</pre>
</p>
<p>
<pre>
> ln -s   ${QBHOME}/svl   ${HOME}/svl/qb_lib.svl
</pre>
</p>
Note:  the link of the subdirectory must be named
<inlinecode> qb_lib.svl </inlinecode>.
</p>

<p>  If you are having difficulties with the installation, see the
<a href="#trouble">troubleshooting</a> section.
</p>

<h2><a name="start"></a>Getting Started</h2>
<p>
The workflow of MOEDivcon QMScoring involves four steps:
<ul>
  <li>Prepping the receptors and ligand (poses) involved in the calculation.
  </li>
  <li>Setting up the run parameters to QMScore. </li>
  <li>Executing QMScore either on a local machine or in parallel on a cluster.
  </li>
  <li>Analyzing the QMScore results.  </li>
</ul>
</p>
<p>
To demonstrate the process, let's work through a simple example.  First, open
<x>simplecomplex.moe</x> from the MOEDivcon examples directory.  Then,
select the MOE menu <w>Compute</w>, submenu <w>Simulations</w>, submenu
<w>QuantumBio</w>, and menu item <w>QMScore</w> (see below).
</p>
<p>
<object id="MOEwithMenu" width=1000 align=center vspace=12px
data="images/mainwithmenu.png" type=image/png>
</p>
<p>
The QMScore dialog should appear with the default values (see below).
</p>
<p>
<object id="QMScoreDefaultDialog" align=center vspace=12px
data="images/qmscoredefault.png" type=image/png>
</p>
<p>
Click on the arrow in the <w>Working Dir</w> drop down menu and select
<inlinecode>/tmp</inlinecode> (files for storing intermediate
calculations will be written here).  Press the <w>Run</w> button.  If all goes
well, QMScore will execute using the receptor and ligand complex shown in
the MOE Window.  After several seconds, the MOE database viewer should open
the QMScore database showing the results (see below).
</p>
<p>
<object id="QMScoreDatabase" width=1000 align=center vspace=12px
data="images/qmscoredatabase.png" type=image/png>
</p>

<p>
In this simple example, one was able to perform all four workflow steps
in one session within the MOE Window, probably not something you would wish
to do with a large protein receptor for which the execution time may take
hours.
</p>
<p>
The real power of MOEDivcon QMScore
is the ability to use moebatch to execute tasks in parallel on a cluster
and collate the results in a MOE database.  In this case, one would prep
the molecules with MOE and set up the QMScore parameters in one
session, then use moebatch to execute the tasks in parallel on a cluster.
After the QMScore runs have completed, one can use MOE to open the QMScore
database to view the collated results.
See the <a href="#parallel">Parallel Execution</a>
section for more information on taking advantage of this feature.
</p>

<h2><a name="options"></a>Options</h2>
<p>
<p><todo> Describe the options.  </todo></p>

Note:  not all options are fully implemented at this time.

</p>
<h3><a name="options-outdb"></a>Output MOE Database</h3>
<p>
MOEDivcon uses the same MOE database to store run parameters and to store
QMScore results.  The advantage is that the database is self-contained:  all
of the data and parameters needed to execute QMScore are stored in the
database.  The database can be moved to a working directory prior to
execution time as long as the correct path is provided to the moebatch
command (see the <a href="#parallel-moebatch">Moebatch</a>
section for more information).
</p>
<p>
</p>

<h3><a name="options-workdir"></a>Working Directory</h3>
<p>
The working directory is used for storing QuantumBio Divcon intermediate
calculations.  The absolute path to the specified directory will
be stored in the QMScore database and used at execution time.  If you are
going to submit the QMScore job on a cluster and don't know what the working
directory will be ahead of time, you can select the CWD option.
</p>
<p>
<object id="QMScoreCWD" align=center vspace=12px
data="images/qmscorecwd.png" type=image/png>
</p>
In this case the current working directory will be set using the run time
environment variable <inlinecode>$PWD</inlinecode>.

<h3><a name="options-ham"></a>Hamiltonian</h3>
<p>
Several options are available in chosing the Hamiltonian algorithm to use
with QMScore.  However, PM3 the default, has proved to be the most reliable.

<p><todo> Describe more completely chemistry-related options.  </todo></p>

</p>

<h3><a name="options-opt"></a>Ligand Optimization</h3>
<p>
A QM-based ligand optimization can be performed prior to scoring.
This optimization may occur either while the ligand is docked within
the target or while the ligand is separate from the target.
Warning: this optional step will significantly increase the CPU cost
of the calculation.

<p><todo> Describe more completely chemistry-related options.  </todo></p>

</p>

<h3><a name="options-freq"></a>Frequency</h3>
<p>
Perform frequency calculation to determine ligand entropy in score
function.  Warning: may increase CPU cost of the calculation.

<p><todo> Describe more completely chemistry-related options.  </todo></p>

</p>

<h2><a name="parallel"></a>Batch and Parallel Execution</h2>
<p>
As described in the <a href="#start">Getting Started</a> section, the workflow
of MOEDivcon QMSore proceeds in four step:  preparation, set up, execution,
and analysis.  The first two and last steps are performed using MOE on your
local workstation or laptop.  The third step, execution, is best left to a
computational cluster, whether you are scoring one complex or hundreds.  This
is where moebatch comes into play.
</p>

<h3><a name="parallel-moebatch"></a>Moebatch</h3>
<p>
</p>
Warning:  the number of processors (nodes * ppn) should not exceed the
number of available MOE licenses.

<p>
<pre>
moebatch -mpu moedivcon_machinefile -exec "run ['qmsbatch.svl', ['$USER_DATADB']]" -exit
</pre>
</p>

<h3><a name="parallel-mode"></a>Mapping Mode</h3>
<p>
</p>

<h4><a name="parallel-mode-1to1"></a>One Receptor--One Ligand</h4>
<p>
<p>
<pre>
moebatch -exec "run ['qmsbatch.svl', ['$USER_DATADB']]" -exit
</pre>
</p>

</p>

<h4><a name="parallel-mode-1toM"></a>One Receptor--Many Ligand Poses</h4>
<p>
</p>
<p>
<object id="QMScoreOneToMany" align=center vspace=12px
data="images/qmscoreonetomany.png" type=image/png>
</p>
<p>
<pre>
moebatch -mpu moedivcon_machinefile -exec "run ['qmsbatch.svl', ['$USER_DATADB']]" -exit
</pre>
</p>

<h4><a name="parallel-mode-MtoM"></a>Many Receptors--Many Ligands</h4>
<p>
</p>
<p>
<object id="QMScoreManyToMany" align=center vspace=12px
data="images/qmscoremanytomany.png" type=image/png>
</p>
<p>
<pre>
moebatch -mpu moedivcon_machinefile -exec "run ['qmsbatch.svl', ['$USER_DATADB']]" -exit
</pre>
</p>


<h2><a name="trouble"></a>Troubleshooting</h2>
<p><todo> Verify MOE procedure.  </todo></p>

<ui>
  <li><p><prob>
    I don't know.
    </prob></p><p><sol>
    Why should I care?
  </sol></p></li>
  <li><p><prob>
    I don't know.
    </prob></p><p><sol>
    Why should I care?
  </sol></p></li>
  <li><p><prob>
    I submitted a parallel PBS (SGE, etc.) QMScore batch script and it returned
    immediately without executing any jobs.
    </prob></p><p><sol>
    If the script requested more processors than the number of available MOE
    licenses, moebatch will fail. Sometimes an error message explaining
    the reason will make it back to the stderr, more often not.
    </sol></p>
    <p><sol>
    The cluster manager (PBS, SGE, etc.) is not properly configured for
    submitting parallel jobs.  That is, the variable $PBS_NODEFILE, file
    $TMPDIR/machines, etc., are not being properly initiated.  You can either
    configure the cluster manager for parallel submissions, or generate the
    moedivcon_machinefile by hand.

    <p><todo> Describe the very messy method of generating machine files.  </todo></p>

    </sol></p></li>
  <li><p><prob>
    The QuantumBio submenu is not appearing in the MOE menu system.
    </prob></p>
    <p><sol>MOE requires that custom menu files
    (<inlinecode>moe_menus</inlinecode>) reside in the user's home directory.
    Either copy, link, or concatenate the MOEDivon custom menu into yours (see
    the <a href="#install">Installation</a> section for details).
  </sol></p></li>
  <li><p><prob>
    I got the message: "No molecular complex loaded in MOE Window."  Why?
    </prob></p><p><sol>
    When using QMScore in 'One-to-One' or 'One-to-Many' mode, you need to first
    open the molecule files (.pdb, .moe, etc) of the complex (or receptor and
    ligand separately) into MOE.  MOEDivcon populates the QMScore database with
    the molecular data in the MOE View.
  </sol></p></li>
  <li><p><prob>
    I got the message:  "No ligand was recognized.  Use LigX to define it."
    Why?
    </prob></p><p><sol>
    For most protein/ligand complexes, MOE should be able to identify the ligand
    using its heuristics.  However in smaller systems, especially when the
    receptor has been cut, the ligand isn't always easily picked out.  You can
    assist the process with this quick guide to LigX.
    <ol>
      <li> Select an atom in the ligand. </li>
      <li> Extend the selection to entire molecule. </li>
      <li> In <w>LigX</w>, select menu <w>Prepare</w> and submenu item
           <w>Select Ligand</w></li>
      <li> Exit out of <w>LigX</w>. </li>
      <li> LigX alters the MOE View for pocket elucidation.  To clean up the
           View, select MOE menus <w>Show All</w> and <w>Color Element</w>.
      </li>
    </ol>
    MOEDivcon should now be able to identify the ligand.
  </sol></p></li>
  <li><p><prob>
    I got the message: "Ligand has to be a single molecule."  What does this
    mean?
    </prob></p><p><sol>
    The current version of QMScore expects one receptor and one ligand.  The
    receptor may comprise many chains, solvents, etc.  The ligand, no--only a
    single molecule.  If your problem involves multiple ligands within the
    same complex, we recommend you isolate each ligand for independent
    analysis.  Or contact our scientific support group to resolve this issue
    in a future release.
     <p><todo> Support contact information?  </todo></p>

 </sol></p></li>
  <li><p><prob>
    How do I know when all jobs of a MOEDivcon batch run have completed, or
    more importantly, are likely to converge.
    </prob></p><p><sol>
    Presently, MOEDivcon has no mechanism to show the user the progress of a
    calculation or whether it is converging.  This will be addressed in a future
    release of MOEDivcon.
  </sol></p></li>
</ui>


<p><todo> Support contact information?  </todo></p>


<hr>
<p>&#169; 2009 by QuantumBio, Inc.</p>

</body>

</html>
