<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN">
<html>
<head>
<title>MOEDivcon QMScore Help</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<meta http-equiv="content-style-type" content="text/css" />
<style>
h1 {font: bold 2.0em Helvetica, sans-serif; color: #0099DD;
    text-align: center;}
h2 {font: bold 1.5em Helvetica, sans-serif; color: #44AAEE;
    background-color: #FFFFFF; counter-increment:h2n;counter-reset:h3n}
h2:before {content: counter(h2n, upper-roman) ".  "}
h3 {font: bold 1.25em Helvetica, sans-serif; color: #44AAEE;
    background-color: #FFFFFF;counter-increment:h3n;counter-reset:h4n}
h3:before {content: counter(h3n, upper-latin) ".  "}
h4 {font: bold 1.00em Helvetica, sans-serif; color: #0099DD;
    background-color: #FFFFFF;counter-increment:h4n;}
h4:before {content: counter(h4n, decimal) ".  "}
body {font: 12pt "Times New Roman", serif; margin: 3em;
    background-color: #F0F7FF;}
ol#tocl {list-style-type: upper-roman;}
ol ol {list-style-type: upper-latin;}
w {text-decoration: underline;}
x {font-weight: bold;}
todo {font: bold 11pt "Helvetica", sans-serif; padding: 1px 2px; margin: 2px;
      border: thin solid red;}
todo:before {content: "TODO: "; color: red;}
pre {margin-left: 4em; font: bold 11pt "Courier", serif;}
inline {font: bold 11pt "Courier", serif;}
prob {font: italic 11pt "Helvetica", sans-serif; background-color: #FFFFFF;}
sol {font: 12pt "Times New Roman", serif;}
sol:before {content: "Possible solution:  "; color:  #0099DD; }
sup {font: bold 1.5em Helvetica, sans-serif; color: #0099DD;
    text-align: center;}
</style>
</head>

<body>
<hr>
<p>
<a href="http://www.quantumbioinc.com" target="QBHomePage"> <object height=51
  align=left
  data="images/qb_logo.png" type=image/png title="QuantumBio Homepage">
QuantumBio Homepage
</object> </a>
<a href="http://www.quantumbioinc.com"target="QBHomePage"> <object height=51
  align=right
  data="images/qb_logo.png" type=image/png title="QuantumBio Homepage">
QuantumBio Homepage
</object> </a>
<h1>MOEDivcon QMScore</h1>

<hr>

<h2><a name="ToC"></a>Table of Contents</h2>
<ol id=tocl>
  <li><a href="ToC">Table of Contents</a></li>
  <li><a href="#intro">QMScore Introduction</a></li>
  <li><a href="#install">Installation</a></li>
  <li><a href="#start">Getting Started</a></li>
  <li><a href="#parallel">Batch and Parallel Execution</a></li>
  <ol>
    <li><a href="#parallel-mode">Parallel Mapping Mode</a></li>
    <li><a href="#parallel-moebatch">Moebatch</a></li>
  </ol>
  <li><a href="#options">Options</a></li>
  <ol>
    <li><a href="#options-outdb">Output MOE Database</a></li>
    <li><a href="#options-workdir">Working Directory</a></li>
    <li><a href="#options-ham">Hamiltonian</a></li>
    <li><a href="#options-opt">Ligand Optimization</a></li>
    <li><a href="#options-freq">Frequency</a></li>
  </ol>
  <li><a href="#trouble">Troubleshooting</a></li>
  <li><a href="#contact">Support Contact Information</a></li></ol>

<h2><a name="intro"></a>QMScore Introduction</h2>

<p>
Analogous to conventional scoring functions from other vendors, QuantumBio
provides a scoring function based upon linear-scaling, semi-empirical, quantum
mechanics. This patent pending algorithm characterizes the entire target/ligand
complex quantum mechanically, and determines the energy of binding.
<p>
The QMScore algorithm has been validated against several key structural motifs,
and the results of these validations have been detailed in several 
key peer-reviewed 
<a href="http://www.quantumbioinc.com/Support/Publications/index_files/category-qmscore.html"
   target="QBHomePage">publications</a>.

<h2><a name="install"></a>Installation</h2>
<p>
MOEDivcon is part of the QuantumBio Distribution, which is packaged in a
<inline>tar.gz</inline> file that uses the following naming convention 
<inline>quantumbio-&lt;platform&gt;-&lt;version&gt;.tar.gz</inline>.  Move
the file where you wish to install the QuantumBio software (e.g., 
<inline>/usr/local</inline>), then uncompress and untar the file.
<pre>
&gt; tar  -zxvf  quantumbio-&lt;platform&gt;-&lt;version&gt;.tar.gz
</pre>
We will
use <inline>$QBHOME</inline> to refer to the path where the package is
installed.  For instance, if you install linux version 5.0.0.1 in
the <inline>/usr/local</inline> directory, 
<inline>$QBHOME</inline> will
refer to <inline>/usr/local/quantumbio-linux-5.0.0.1</inline>.

<p><a name="install-menu"></a>
The final steps of the installation set up your environment to run MOEDivcon.
First, you need to copy the MOEDivcon menu file to your home directory.  If
you already have a custom MOE menu, you need to concatenate the files.
For example, either
<pre>
&gt; cp  ${QBHOME}/moe_menus  ${HOME}/moe_menus
</pre>
or
<pre>
&gt; cat  ${YOURMENUDIR}/moe_menus  ${QBHOME}/moe_menus  >  ${HOME}/moe_menus
</pre>

<p><a name="install-svl"></a>
In order for
MOE to locate the MOEDivcon SVL library, you must create a link to the
library in a place where MOE can find it.  If you already have a directory
of SVL scripts, link the MOEDivcon SVL libarary as a subdirectory.
For example:
<pre>
&gt; ln -s  ${QBHOME}/svl  ${MOE_SVL_PATH}/qb_lib.svl
</pre>
Otherwise, create an SVL directory in your home directory and link the
MOEDivcon SVL library under it.  For example:
<pre>
&gt; mkdir  ${HOME}/svl<br>
&gt; ln -s  ${QBHOME}/svl  ${HOME}/svl/qb_lib.svl<br>
</pre>

<p><a name="install-path"></a>
Before you can run QMScore using MOE or moebatch, you need to make sure that
the MOEDivcon executables are in your path and the MOEDivcon SVL library is in
your MOE run path.  For example, you should add to your .bashrc file:<pre>export  PATH=${QBHOME}/bin:${PATH}<br>
if [ -z  $MOE_SVL_RUNPATH ] ; then<br>
  export  MOE_SVL_RUNPATH="${QBHOME}/svl"<br>
else<br>
  export  MOE_SVL_RUNPATH="${QBHOME}/svl:$MOE_SVL_RUNPATH"<br>
fi<br>
</pre>
or add to your .cshrc file:
<pre>
setenv  PATH  ${QBHOME}/bin:${PATH}<br>
if ( $?MOE_SVL_RUNPATH ) then<br>
  setenv  MOE_SVL_RUNPATH  ${QBHOME}/svl:$MOE_SVL_RUNPATH<br>
else<br>
  setenv  MOE_SVL_RUNPATH  ${QBHOME}/svl<br>endif<br>
</pre>

<p><a name="install-license"></a>
MOEDivcon is distributed with an evaluation license that will eventually 
expire. Contact sales@quantumbioinc.com to purchase a license file. 
Once you have received a license file
from QuantumBio, you can install the file with a simple move statement.<pre>
&gt; mv  license-file  $QBHOME/etc/license
</pre>

If you are having difficulties with the installation, see the
<a href="#contact">Support Contact Information</a> section.

<h2><a name="start"></a>Getting Started</h2>
<p>
To verify that the installation was successful, let's work through a 
simple example.  If you run into any problems, see the <a href="#trouble">
troubleshooting</a> section.
<p>
The workflow of MOEDivcon QMScoring involves four steps:
<ol>
  <li>Prepping the receptors and ligand (poses) involved in the calculation.
  </li>
  <li>Setting up the run parameters to QMScore. </li>
  <li>Executing QMScore either on a local machine or in parallel on a cluster.
  </li>
  <li>Analyzing the QMScore results.  </li>
</ol>
<p>
First, start MOE and open 
<inline>${QBHOME}/examples/simplecomplex.moe</inline>.  Then,
select the MOE menu <w>Compute</w>, submenu <w>Simulations</w>, submenu
<w>QuantumBio</w>, and menu item <w>QMScore</w> (see below).
<p>
<object id="MOEwithMenu" title="Moe Window with QuantumBio Menu" width=1000 
data="images/mainwithmenu.png" type=image/png>
Moe Window with QuantumBio Menu
</object>
<p>
The QMScore dialog should appear with the default values (see below).
<p>
<object id="QMScoreDefaultDialog" title="QMScore Dialog"
data="images/qmscoredefault.png" type=image/png>
QMScore Dialog
</object>
<p>
Ensure that the <w>Working Dir</w> is 
<inline>/tmp</inline> (files for storing intermediate calculations and logs
 will be written here).  Press the <w>Run</w> button.  If all goes
well, QMScore will execute using the receptor and ligand complex shown in
the MOE Window.  After several seconds, the MOE database viewer should open
the QMScore database showing the results (see below).
<p>
<object id="QMScoreDatabase" title="QMScore Database" width=1000 
data="images/qmscoredatabase.png" type=image/png>
QMScore Database
</object>
<p>
In this simple example, you were able to perform all four workflow steps
in one session within the MOE Window, probably not something you would wish
to do with a large protein receptor for which the execution time may take
several hours.
<p>
The real power of MOEDivcon QMScore
is the ability to use moebatch to execute tasks in parallel on a cluster
and collate the results in a MOE database.  In this case, one would prep
the molecules with MOE and set up the QMScore parameters in one
session, then use moebatch to execute the tasks in parallel on a cluster.
After the QMScore runs have completed, one can use MOE to open the QMScore
database to view the collated results.

<h2><a name="parallel"></a>Batch and Parallel Execution</h2>
<p>
As described in the <a href="#start">Getting Started</a> section, the workflow
of MOEDivcon QMSore proceeds in four step:  preparation, set up, execution,
and analysis.  The prep, set up, and analysis steps are performed using MOE on
your local workstation or laptop.  The third step, execution, is best left to a
computational cluster, whether you are scoring one complex or hundreds.  

<p>
This
is where moebatch comes into play.


<h3><a name="parallel-mode"></a>Mapping Mode</h3>
<p>
The mapping mode determines how receptors are to be mapped to ligand (poses).

<h4><a name="parallel-mode-1to1"></a>One Receptor--One Ligand</h4>
<p>
In <w>One-to-One</w> mode, the set up is the same as in the 
<a href="#start">Getting Started</a> section.  Open the receptor
and ligand files into the MOE Window, perform any necessary preparations,
open the QMScore dialog and chose your options, and then chose <w>Save</w>
rather than <w>Run</w>.  MOEDivcon will store your receptor, ligand, and 
options in the QMScore database, and then open the MOE DB viewer so you can
verify the data.  
<p>
After you close the database, you can execute QMScore with
moebatch from the command line:
<pre>
&gt; moebatch -exec "run ['qmsbatch.svl', ['$USER_DATADB']]" -exit
</pre>
where <inline>$USER_DATADB</inline> is the path to your database.  You can
also execute moebatch by submitting the job to a cluster queue.  Example
scripts for PBS and SGE are located in <inline>${QBHOME}/scripts</inline>.
<h4><a name="parallel-mode-1toM"></a>One Receptor--Many Ligand Poses</h4>
<p>
In <w>One-to-Many</w> mode, the set up is similar to  
<a href="#parallel-mode-1to1"><w>One-to-One</w></a> mode.  The difference
is that you need to create a MOE database to store the ligand poses generated
by your favorite docking program beforehand.

<p>
Open the receptor
and ligand files into the MOE Window, open the QMScore dialog and chose your 
options.  When you select the <w>One-to-Many</w> mode, you will be prompted
to supply a ligand/pose database.
<p>
<object id="QMScoreOneToMany" title="QMScore One-to-Many Mode"
data="images/qmscoreonetomany.png" type=image/png >
QMScore One-to-Many Mode
</object>
<p>
When you chose <w>Save</w>,  MOEDivcon will store your receptor, ligand, and 
options in the QMScore database, and it will copy the ligand/pose database into
the QMScore database including any data fields (e.g., results from other scoring
algorithms).  The MOE DB viewer will then open the QMScore database so 
you can verify the data. 
<p>
After you close the database, you can execute QMScore with
moebatch from the command line: 
<pre>
moebatch -mpu moedivcon_machinefile -exec "run ['qmsbatch.svl', ['$USER_DATADB']]" -exit
</pre>
where <inline>$USER_DATADB</inline> is the path to your database and
<inline>moedivcon_machinefile</inline> specifies the MOE machine file (see
the MOE/smp documentation for details on the machine file).  You can
also execute moebatch by submitting the job to a cluster queue.  Example
scripts for PBS and SGE are located in <inline>${QBHOME}/scripts</inline>.  The
scripts also demonstrate how to automatically generate the MOE machine file.

<h4><a name="parallel-mode-MtoM"></a>Many Receptors--Many Ligands</h4>
<p>

<p>
<object id="QMScoreManyToMany" title="QMScore Many-to-Many Mode"
data="images/qmscoremanytomany.png" type=image/png>
QMScore Many-to-Many Mode
</object>
<p>
<pre>
moebatch -mpu moedivcon_machinefile -exec "run ['qmsbatch.svl', ['$USER_DATADB']]" -exit
</pre>


<h3><a name="parallel-moebatch"></a>Moebatch</h3>
<p>

Warning:  the number of processors (nodes * ppn) should not exceed the
number of available MOE licenses.

<p>
<pre>
moebatch -mpu moedivcon_machinefile -exec "run ['qmsbatch.svl', ['$USER_DATADB']]" -exit
</pre>


<h2><a name="options"></a>Options</h2>
<p>

<em>Note:  not all options are fully implemented at this time.</em>


<h3><a name="options-outdb"></a>Output MOE Database</h3>
<p>
MOEDivcon uses a MOE database to store run parameters and to store
QMScore results.  One advantage is that the database is self-contained:  all
of the data and parameters needed to execute QMScore are stored in the
database.  The database can be moved to a working directory prior to
execution time as long as the correct path is provided to the moebatch
command (see the <a href="#parallel-moebatch">Moebatch</a>
section for more information).  Another advantage is the suite of MOE 
data analysis tools designed to work with its database.

<h3><a name="options-workdir"></a>Working Directory</h3>
<p>
The working directory is used for storing QuantumBio Divcon intermediate
calculations and log files.  The path to the specified directory will
be stored in the QMScore database and resolved at execution time.  If you are
going to submit the QMScore job on a cluster, you can specify the absolute
path to a scratch directory mounted on the cluster's file system.  Because of
this possible scenerio, there is no check whether the directory actually
exists.  If QMScore is executed using moebatch, a subdirectory under the 
working directory named <inline>qb_out<em>N</em></inline>
will be created for each numbered task <inline><em>N</em></inline>.
<p>
An alternative to specifying a working directory is to use the <w>CWD</w>
option.
<p>
<object id="QMScoreCWD" title="QMScore CWD Option"
data="images/qmscorecwd.png" type=image/png>
QMScore CWD Option
</object>
<p>
In this case the current working directory will be set using the run time
environment variable <inline>$PWD</inline>.  This is effectively equivalent
to specifying <inline>'.'</inline> as the working directory.  If you use
the <w>CWD</w> option when executing in moebatch parallel mode, each child task
will create a subdirectory under the current working directory of the moebatch
process.

<h3><a name="options-ham"></a>Hamiltonian</h3>
<p>
Several options are available in chosing the Hamiltonian algorithm to use
with QMScore.  However, PM3, the default, has proved to be the most reliable.


<h3><a name="options-opt"></a>Ligand Optimization</h3>
<p>
A QM-based ligand optimization can be performed prior to scoring.
This optimization may occur either while the ligand is docked within
the target or while the ligand is separate from the target.
Warning: this optional step will significantly increase the CPU cost
of the calculation.  <em>Note:  not fully implemented yet.</em>


<h3><a name="options-freq"></a>Frequency</h3>
<p>
Perform frequency calculation to determine ligand entropy in score
function.  Warning: may increase CPU cost of the calculation.
<em>Note:  not implemented yet.</em>


<h2><a name="trouble"></a>Troubleshooting</h2>
We list here potential problems using the MOEDivcon integration and possible
solutions.  If your problem is not listed here or the proposed solution 
doesn't help, please <a href="#contact">contact</a> support.
<ui>
  <li><p><prob>
    The QuantumBio submenu is not appearing in the MOE menu system.
    </prob>
    <p><sol>MOE requires that custom menu files
    (<inline>moe_menus</inline>) reside in the user's home directory.
    Either copy, link, or concatenate the MOEDivon custom menu into yours (see
    the <a href="#install-menu">menu installation</a> section).
  </sol></li>
  <li><p><prob>
    I get the MOE message:
    <pre>
run: Environment variable not found.
    </pre>
    </prob><p><sol>
    MOE's run is unable to find the MOEDivcon SVL scripts.  Make sure the
    <inline>MOE_SVL_RUNPATH</inline> is 
    set up correctly (see the <a href="#install-path">installation</a>
    section).
  </sol></li>
  <li><p><prob>
    I get the MOE message:
    <pre>
No molecular complex loaded in MOE Window.
    </pre>
    </prob><p><sol>
    When using QMScore in 'One-to-One' or 'One-to-Many' mode, you need to first
    open the molecule files (.pdb, .moe, etc.) of the complex (or receptor and
    ligand separately) into MOE.  MOEDivcon populates the QMScore database with
    the molecular data in the MOE Window.
  </sol></li>
  <li><p><prob>
    I get the MOE message:
    <pre>
No ligand was recognized.  Use LigX to define it.
    </pre>
    </prob><p><sol>
    For most protein/ligand complexes, MOE should be able to identify the ligand
    using its heuristics.  However in smaller systems, especially when the
    receptor has been cut, the ligand isn't always easily picked out.  You can
    assist the process with this quick guide to LigX.
    <ol>
      <li> Select an atom in the ligand. </li>
      <li> Extend the selection to entire molecule
      (<w>Select</w>&rarr;<w>Extend </w>&rarr;<w>Molecule</w>). </li>
      <li> In <w>LigX</w>, select menu <w>Prepare</w> and submenu item
           <w>Choose Ligand</w>.</li>
      <li> <w>Quit LigX</w>. </li>
      <li> LigX alters the MOE View for pocket elucidation.  To clean up the
           View, select MOE menus <w>Show</w>&rarr;<w>All</w>
           and <w>Color</w>&rarr;<w>Element</w>.
      </li>
    </ol>
    MOEDivcon should now be able to identify the ligand.
  </sol></li>
  <li><p><prob>
    I get the MOE message:
    <pre>
Ligand has to be a single molecule.
    </pre>
    </prob><p><sol>
    The current version of QMScore expects one receptor and one ligand.  The
    receptor may comprise many chains, solvents, etc.  The ligand has to
    a single molecule.  If your problem involves multiple ligands within the
    same complex, we recommend you isolate each ligand for independent
    analysis.  Or <a href=#contact>contact</a> our scientific support group
    to resolve this issue in a future release.
  </sol></li>
  <li><p><prob>
    I get the MOE message:
    <pre>
    qb_QMScore: fwrite: Broken pipe.
    </pre>
    </prob><p><sol>
    MOE is unable to find the MOEDivcon executables.  Make sure the 
    <inline>PATH</inline> is 
    set up correctly (see the <a href="#install-path">installation</a>
    section).
  </sol></li>
  <li><p><prob>
    I get the message in the <w>Status</w> field of the QMScore database:
    <pre>
Error:   LICENSE ERROR: Problem with license file. Be sure that QBHOME is set correctly and license file is correct.Error Code: 1003.
    </pre>
    </prob><p><sol>
    MOEDivcon is distributed with an evaluation license which expires after a
    few months.  See the <a href="#install-license">license installation</a>
    section for more information on purchasing and installing a license.
  </sol></li>
  <li><p><prob>
    I don't know.
    </prob><p><sol>
    Why should I care?
  </sol></li>
  <li><p><prob>
    I submitted a parallel PBS (SGE, etc.) QMScore batch script and it returned
    immediately without executing any jobs.
    </prob><p><sol>
    If the script requested more processors than the number of available MOE
    licenses, moebatch will fail. Sometimes an error message explaining
    the reason will make it back to the stderr, more often not.
    </sol>
    <p><sol>
    The cluster manager (PBS, SGE, etc.) is not properly configured for
    submitting parallel jobs.  That is, the variable $PBS_NODEFILE, file
    $TMPDIR/machines, etc., are not being properly initiated.  You can either
    configure the cluster manager for parallel submissions, or generate the
    moedivcon_machinefile by hand.

    <p><todo> Describe the very messy method of generating machine files.  </todo>

    </sol></li>
  <li><p><prob>
    How do I know when all jobs of a MOEDivcon batch run have completed, or
    more importantly, are likely to converge.
    </prob><p><sol>
    Presently, MOEDivcon has no mechanism to show the user the progress of a
    calculation or whether it is converging.  This will be addressed in a future
    release of MOEDivcon.
  </sol></li>
</ui>

<h2><a name="contact"></a>Support Contact Information</h2>

<p>
<a href="http://www.quantumbioinc.com/Support/index.html"
   target="QBHomePageSupport"> <object height=51 align=left
   data="images/qb_logo.png" type=image/png title="QuantumBio Support Page">
QuantumBio Support Page
</object> </a>
<a href="http://www.quantumbioinc.com/Support/index.html"
   target="QBHomePageSupport"> <object id=ri height=51 align=right
   data="images/qb_logo.png" type=image/png title="QuantumBio Support Page">
QuantumBio Support Page
</object> </a>
<sup>
<div>
QuantumBio Inc.<br>
200 Innovation Blvd.<br>
State College, PA 16803<br>
Phone: 814-308-9406<br>
Fax: 814-235-6909<br>
email: support@quantumbioinc.com
</div>
</sup>


<hr>
<p>&copy;2009 by QuantumBio, Inc.

</body>

</html>
