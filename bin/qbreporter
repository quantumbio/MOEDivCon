#!/bin/sh

# Terminate the script if any simple command fails.
#set -e

function pause(){
   read -n 1 -p "Press any key to continue..."
}

if [ ! "$QBHOME" ]; then
    PRG=$0
    
    progdir=`dirname "$PRG"`
    if [ "$progdir" = "." ]; then
	    progdir=`pwd`
    fi
    
    if [ "`echo "$progdir" | grep -s '^/'`" ]; then
        progdir=$progdir
    else
        progdir=`pwd`/"$progdir"
    fi
    
    QBHOME=`echo "$progdir" | sed 's:/bin$::'`
    export QBHOME
fi

    . ${QBHOME}/etc/qbenv.sh

soffice "-accept=socket,host=localhost,port=2083;urp;StarOffice.ServiceManager" &

export LD_LIBRARY_PATH=$QBHOME/${PLTFM_VER}/lib:$LD_LIBRARY_PATH

sd_prog=`which soffice`
sd_prog=`dirname "$sd_prog"`
if [ -x "$sd_prog/../basis-link/ure-link/bin/javaldx" ] ; then
    my_path=`"$sd_prog/../basis-link/ure-link/bin/javaldx" $BOOTSTRAPVARS \
        "-env:INIFILENAME=vnd.sun.star.pathname:$sd_prog/redirectrc"`
    if [ -n "$my_path" ] ; then
        LD_LIBRARY_PATH=$my_path${LD_LIBRARY_PATH:+:$LD_LIBRARY_PATH}
        export LD_LIBRARY_PATH
    fi
fi

JAVA_HOME=`$sd_prog/../basis-link/ure-link/bin/javaldx | awk -F ":" '{print $1}'`

while [ ! -e ${JAVA_HOME}/bin/java ] ; do
    JAVA_HOME=`dirname "$JAVA_HOME"`
    if [ "$JAVA_HOME" = "/" ] ; then
        break
    fi
done

export JAVA_HOME
export PATH=$JAVA_HOME/bin:$PATH

export CLASSPATH=$QBHOME/${PLTFM_VER}/HDFView.jar:$QBHOME/linux-x86_64/lib/args4j-2.0.17-SNAPSHOT.jar:$sd_prog/../basis-link/ure-link/share/java/java_uno.jar:$sd_prog/../basis-link/ure-link/share/java/unoloader.jar:$sd_prog/../basis-link/ure-link/share/java/juh.jar:$sd_prog/../basis-link/ure-link/share/java/jurt.jar:$sd_prog/../basis-link/ure-link/share/java/ridl.jar:$QBHOME/linux-x86_64/QBReporter.jar
echo "CLASSPATH"$CLASSPATH
echo "LD_LIBRARY_PATH"$LD_LIBRARY_PATH

java -DQBHOME=$QB_PATH -Djava.library.path=$LD_LIBRARY_PATH -classpath $CLASSPATH com.quantumbioinc.reporter.Main -i $1




pause
